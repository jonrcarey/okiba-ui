{"version":3,"file":"index.esm.js","sources":["../index.js"],"sourcesContent":["import EventEmitter from '@okiba/event-emitter'\nimport SizesCache from '@okiba/sizes-cache'\nimport ScrollManager from '@okiba/scroll-manager'\nimport EventManager from '@okiba/event-manager'\nimport {map} from '@okiba/math'\n\nexport default class ViewProgress extends EventEmitter {\n  constructor(el, opts) {\n    super()\n    this.opts = opts || {}\n    this.el = el\n    this.sizes = SizesCache.get(el)\n    this.isInside = false\n    this.onResize()\n    this.listen()\n  }\n\n  onScroll = ({y, ...rest}) => {\n    if (!this.opts.overflow && !this.isInside) {\n      if (y < this.startY || y > this.endY) return\n    }\n\n    const progress = map(y, this.startY, this.endY, 0, 1)\n    const isInside = progress >= 0 && progress <= 1\n\n    if (isInside !== this.isInside) {\n      if (isInside) {\n        this.emit('enter')\n      } else {\n        this.emit('exit')\n      }\n    }\n\n    this.isInside = isInside\n    this.emit('progress', {progress, isInside, ...rest, y})\n  }\n\n  onResize = () => {\n    const {top, height} = this.sizes\n\n    this.startY = top - SizesCache.window.height\n    this.endY = this.startY + height + SizesCache.window.height\n\n    if (this.endY >= SizesCache.body.height) {\n      this.endY = this.startY + height\n    }\n\n    if (this.startY < 0) {\n      this.startY = 0\n      this.endY = height\n    }\n  }\n\n  listen() {\n    ScrollManager.on('scroll', this.onScroll)\n    EventManager.on('resize', this.onResize)\n  }\n}\n"],"names":["ViewProgress","el","opts","y","rest","overflow","isInside","startY","endY","progress","map","emit","sizes","top","height","SizesCache","window","body","get","onResize","listen","ScrollManager","on","onScroll","EventManager","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMqBA;;;;;wBACPC,EAAZ,EAAgBC,IAAhB,EAAsB;;;;;;;+DAUX,gBAAkB;UAAhBC,CAAgB,QAAhBA,CAAgB;UAAVC,IAAU;;UACvB,CAAC,MAAKF,IAAL,CAAUG,QAAX,IAAuB,CAAC,MAAKC,QAAjC,EAA2C;YACrCH,CAAC,GAAG,MAAKI,MAAT,IAAmBJ,CAAC,GAAG,MAAKK,IAAhC,EAAsC;;;UAGlCC,QAAQ,GAAGC,GAAG,CAACP,CAAD,EAAI,MAAKI,MAAT,EAAiB,MAAKC,IAAtB,EAA4B,CAA5B,EAA+B,CAA/B,CAApB;UACMF,QAAQ,GAAGG,QAAQ,IAAI,CAAZ,IAAiBA,QAAQ,IAAI,CAA9C;;UAEIH,QAAQ,KAAK,MAAKA,QAAtB,EAAgC;YAC1BA,QAAJ,EAAc;gBACPK,IAAL,CAAU,OAAV;SADF,MAEO;gBACAA,IAAL,CAAU,MAAV;;;;YAICL,QAAL,GAAgBA,QAAhB;;YACKK,IAAL,CAAU,UAAV;QAAuBF,QAAQ,EAARA,QAAvB;QAAiCH,QAAQ,EAARA;SAAaF,IAA9C;QAAoDD,CAAC,EAADA;;KA3BhC;;+DA8BX,YAAM;wBACO,MAAKS,KADZ;UACRC,GADQ,eACRA,GADQ;UACHC,MADG,eACHA,MADG;YAGVP,MAAL,GAAcM,GAAG,GAAGE,UAAU,CAACC,MAAX,CAAkBF,MAAtC;YACKN,IAAL,GAAY,MAAKD,MAAL,GAAcO,MAAd,GAAuBC,UAAU,CAACC,MAAX,CAAkBF,MAArD;;UAEI,MAAKN,IAAL,IAAaO,UAAU,CAACE,IAAX,CAAgBH,MAAjC,EAAyC;cAClCN,IAAL,GAAY,MAAKD,MAAL,GAAcO,MAA1B;;;UAGE,MAAKP,MAAL,GAAc,CAAlB,EAAqB;cACdA,MAAL,GAAc,CAAd;cACKC,IAAL,GAAYM,MAAZ;;KA1CkB;;UAEfZ,IAAL,GAAYA,IAAI,IAAI,EAApB;UACKD,EAAL,GAAUA,EAAV;UACKW,KAAL,GAAaG,UAAU,CAACG,GAAX,CAAejB,EAAf,CAAb;UACKK,QAAL,GAAgB,KAAhB;;UACKa,QAAL;;UACKC,MAAL;;;;;;;6BAuCO;MACPC,aAAa,CAACC,EAAd,CAAiB,QAAjB,EAA2B,KAAKC,QAAhC;MACAC,YAAY,CAACF,EAAb,CAAgB,QAAhB,EAA0B,KAAKH,QAA/B;;;;;EAjDsCM;;;;"}